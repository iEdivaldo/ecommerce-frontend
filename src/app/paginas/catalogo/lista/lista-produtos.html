<div class="container py-4">
    <div *ngIf="mostrarAlerta()" 
         class="position-fixed top-2 start-50 translate-middle bg-success text-white px-4 py-3 rounded shadow-lg"
         style="z-index: 9999;">
        <i class="bi bi-check-circle me-2"></i>Produto adicionado ao carrinho!
    </div>
    <div class="alert alert-info w-auto d-inline-block" *ngIf="mensagens && usuarioAtual() as usuario">Bem-vindo, {{ usuario.nome }}!</div>
    <header class="mb-4">
        <h1 class="h3 m-0 text-center w-100">Catálogo</h1>
    </header>
    
    <div *ngIf="carregando" class="alert alert-info">Carregando...</div>

    <div class="row g-3">
        <div class="d-flex gap-3 mb-3 flex-wrap">
            <div>
                <label for="filtroCategoria" class="form-label">Filtrar por Categoria:</label>
                <select id="filtroCategoria" class="form-select" [(ngModel)]="categoriaSelecionada" (ngModelChange)="filtrarPorCategoria()">
                    <option value="" selected>Todas as Categorias</option>
                    <option *ngFor="let categoria of listasCategorias" [value]="categoria.id">{{ categoria.nome }}</option>
                </select>
            </div>
            <div>
                <label for="filtroPesquisa" class="form-label">Pesquisar:</label>
                <input type="text" class="form-control" placeholder="Pesquisar produtos..." [(ngModel)]="filtroPesquisa" (ngModelChange)="filtrarPorPesquisa()">
            </div>
            <div>
                <label for="filtroOrdenacao" class="form-label">Ordenar por:</label>
                <select name="filtroOrdenacao" id="filtroOrdenacao" class="form-select" [(ngModel)]="ordenacaoSelecionada" (ngModelChange)="ordenarProdutos($event)">
                    <option value="" disabled selected>Ordenar por</option>
                    <option value="precoAsc">Preço: Menor para Maior</option>
                    <option value="precoDesc">Preço: Maior para Menor</option>
                    <option value="nomeAsc">Nome: A-Z</option>
                    <option value="nomeDesc">Nome: Z-A</option>
                </select>
            </div>
        </div>
        <div class="col-sm-6 col-md-4 col-lg-3" *ngFor="let p of produtos">
            <div class="card h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="card-title mb-0">{{ p.nomeProduto }}</h5>
                        <span class="badge bg-danger" *ngIf="p.estoqueProduto === 0">Esgotado</span>
                    </div>
                    <p class="card-text small text-muted">{{ p.descricaoProduto || 'Nenhuma descrição disponível no momento.' }}</p>
                    <strong>{{ p.precoProduto | currency:'BRL' }}</strong>
                    <p class="small text-muted mt-1" *ngIf="p.estoqueProduto > 0">
                        <i class="bi bi-box-seam"></i> {{ p.estoqueProduto }} em estoque
                    </p>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <a [routerLink]="['/produtos', p.id]" class="btn btn-sm btn-outline-secondary w-100">Ver detalhes</a>
                </div>
                <div class="card-footer bg-transparent border-0">
                    <button class="btn btn-sm btn-primary w-100" 
                            (click)="adicionarAoCarrinho(p)" 
                            [disabled]="p.estoqueProduto === 0">
                        {{ p.estoqueProduto === 0 ? 'Indisponível' : 'Adicionar ao Carrinho' }}
                    </button>
                </div>
            </div>
        </div>
        <div *ngIf="!produtos.length && !carregando" class="alert alert-warning">Nenhum produto encontrado.</div>
    </div>
</div>